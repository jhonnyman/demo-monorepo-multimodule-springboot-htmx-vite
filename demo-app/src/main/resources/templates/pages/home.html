<!doctype html>
<html
    id="html"
    th:lang="${#locale}"
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:th="https://www.thymeleaf.org"
    data-theme="dark"
>
    <th:block
        th:replace="~{common/head :: head(
        #{common.title.demo-app},
        #{common.description.demo-app},
        @{/},
        @{/img/icon512_maskable.png},
    )}"
    >
        <th:block th:each="css : ${vite.manifestEntry('src/js/pages/home.ts').css}">
            <link rel="stylesheet" th:href="@{${css}}" />
        </th:block>
    </th:block>

    <body hx-boost="true">
        <!-- Page specific loads -->
        <script type="module" th:src="@{${vite.manifestEntry('src/js/pages/home.ts').file}}" defer></script>

        <div th:replace="~{common/header}"></div>

        <main>
            <div class="container">
                <h1>Share a Video Testimony</h1>

                <p>Demo upload with HTMX!</p>

                <div th:if="${user == null}">
                    <p>Create an account first</p>
                    <div th:replace="~{common/header :: login}"></div>
                </div>
                <div th:if="${user != null}">
                    <form
                        id="testimony-upload"
                        action="/testimony/uploads/files"
                        method="post"
                        enctype="multipart/form-data"
                        hx-post="/testimony/uploads/files"
                        hx-on::before-request="const aux = document.getElementById('upload-submit'); aux.disabled = true; aux.ariaDisabled = true"
                        hx-indicator="#upload-video-loading"
                        hx-ext="debug"
                        hx-swap-oob="true"
                        hx-target="body"
                    >
                        <input type="file" name="file" accept="video/*" />

                        <button id="upload-submit" type="submit">Partilhar VÃ­deo</button>
                        <article id="upload-video-loading" class="htmx-indicator" aria-busy="true"></article>

                        <progress id="upload-video-progress" value="0" max="100"></progress>
                        <div th:replace="~{common/csrf-input}"></div>
                    </form>
                </div>
            </div>
        </main>

        <div th:replace="~{common/footer}"></div>
        <noscript th:text="#{common.noscript}"> Enable Javascript for a better experience </noscript>
    </body>
</html>
